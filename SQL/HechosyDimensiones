--Customer_dm

CREATE OR REPLACE TABLE proyecto6-etl.dataset.customer_dm AS 
SELECT
  customer_id,
  customer_name,
  segment
FROM `proyecto6-etl.dataset.superstore3`
GROUP BY
customer_id,
customer_name,
segment;

--Order_dm

CREATE OR REPLACE TABLE proyecto6-etl.dataset.order_dm AS 
SELECT
  unique_id,
  order_priority,
  city,
  region
FROM `proyecto6-etl.dataset.superstore3`
GROUP BY
unique_id,
  order_priority,
  city,
  region

  --Facts_table

CREATE OR REPLACE TABLE `proyecto6-etl.dataset.sales_fact` AS 
SELECT
  unique_id,
  product_id,
  customer_id,
  order_date1,
  shipping_id,
  market_id,
  sales,
  profit,
  discount,
  quantity,
  shipping_cost
FROM 
  `proyecto6-etl.dataset.superstore3`
GROUP BY 
   unique_id,
  product_id,
  customer_id,
  order_date1,
  shipping_id,
  market_id,
  sales,
  profit,
  discount,
  quantity,
  shipping_cost


  --Shipping_dm

CREATE OR REPLACE TABLE proyecto6-etl.dataset.shipping_dm AS 
SELECT
shipping_ID,
shipping_date1,
ship_mode
FROM `proyecto6-etl.dataset.superstore3`
GROUP BY
shipping_ID,
shipping_date1,
ship_mode

--time_dm

CREATE OR REPLACE TABLE proyecto6-etl.dataset.time_dm AS 
SELECT
  order_date1,
  weeknum,
  order_month,
  order_semester,
  year
FROM `proyecto6-etl.dataset.superstore3`
GROUP BY
order_date1,
  weeknum,
  order_month,
  order_semester,
  year

  --product_dm
CREATE OR REPLACE TABLE proyecto6-etl.dataset.product_dm AS 
SELECT
  product_id,
  product_name,
  category,
  sub_category
FROM `proyecto6-etl.dataset.superstore3`
GROUP BY
product_id,
  product_name,
  category,
  sub_category

  --location_dm

  CREATE OR REPLACE TABLE proyecto6-etl.dataset.location_dm AS 
SELECT
  market_id,
  state,
  country,
  market,
  market2
FROM `proyecto6-etl.dataset.superstore3`
GROUP BY
 market_id,
  state,
  country,
  market,
  market2


  --Validaci√≥n--

 --Order_dm
 SELECT md.order_id, SUM(ft.sales) AS total_sales
FROM `proyecto6-etl.dataset.fact_table` ft
JOIN `proyecto6-etl.dataset.order_dm` md ON ft.order_id = md.order_id
GROUP BY md.order_id;

--Customer_dm
SELECT 
    ft.customer_id,
    c.customer_name,
    COUNT(*) AS total_orders
FROM 
    `proyecto6-etl.dataset.fact_table` ft
JOIN 
    `proyecto6-etl.dataset.customer_dm` c
    ON ft.customer_id = c.customer_id
GROUP BY 
    ft.customer_id, c.customer_name;


--Products_dm
SELECT 
    ft.product_id,
    p.product_name,
    SUM(ft.quantity) AS total_quantity_sold,
    SUM(ft.sales) AS total_sales
FROM 
    `proyecto6-etl.dataset.fact_table` ft
JOIN 
    `proyecto6-etl.dataset.product_dm` p
    ON ft.product_id = p.product_id
GROUP BY 
    ft.product_id, p.product_name;


--time_dm
SELECT 
    ft.order_date1,
    t.weeknum,
    t.order_month,
    t.order_semester,
    COUNT(*) AS total_orders
FROM 
    `proyecto6-etl.dataset.fact_table` ft
JOIN 
    `proyecto6-etl.dataset.time_dm` t
    ON ft.order_date1 = t.order_date1
GROUP BY 
    ft.order_date1, t.weeknum, t.order_month, t.order_semester;
